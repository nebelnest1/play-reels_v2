<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <title>(1) Private Video Request</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%23ff0000%22/><path d=%22M35 30 L75 50 L35 70 Z%22 fill=%22%23ffffff%22/></svg>">

  <script>
  var APP_CONFIG = {
    domain: "https://jup9.com",

    // --- 1. Main Exit (–û—Ñ—Ñ–µ—Ä - High CPM) ---
    mainExit_currentTab_zoneId: 10217421,
    mainExit_newTab_zoneId: 10217420,

    // --- 2. Tab Under (–ö–Ω–æ–ø–∫–∞ "Stay") ---
    tabUnderClick_newTab_zoneId: 10557765,

    // --- 3. Age Exit (–ö–Ω–æ–ø–∫–∞ "Leave") ---
    ageExit_currentTab_zoneId: 10557767,
    ageExit_newTab_zoneId: 10557766,

    // –ü—Ä–æ—á–µ–µ
    autoexit_zoneId: 10217422,
    autoexit_timeToRedirect: 30,
    reverse_zoneId: 10217419,
    back_zoneId: 10217423,
    back_count: 8
  };
  </script>

  <style>
    * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    .reels-wrapper { position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; cursor: pointer; background: #000; }

    /* VIDEO LAYERS */
    .video-layer {
      position: absolute; inset: 0; width: 100%; height: 100%;
      object-fit: cover; z-index: 0; background: #000;
      opacity: 0; transition: opacity 0.1s linear; pointer-events: none;

      /* anti-flicker / GPU */
      transform: translateZ(0);
      backface-visibility: hidden;
      will-change: transform, opacity;
    }
    .video-layer.active { opacity: 1; z-index: 1; }
    .video-layer.prep { opacity: 0; z-index: 2; } /* v2 warmed up (in flow, invisible) */

    /* BLUR LOCK */
    .blur-overlay {
      position: absolute; inset: 0; z-index: 30;
      backdrop-filter: blur(12px) brightness(0.7);
      -webkit-backdrop-filter: blur(12px) brightness(0.7);
      display: none; flex-direction: column; align-items: center; justify-content: center;
      pointer-events: auto;
    }
    .lock-badge {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      padding: 24px 32px; border-radius: 28px;
      display: flex; flex-direction: column; align-items: center; gap: 14px;
      box-shadow: 0 15px 45px rgba(0,0,0,0.5);
      transform: translateZ(0);
    }
    .lock-icon-wrap { width: 50px; height: 50px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    .lock-badge h2 { color: #fff; margin: 0; font-size: 18px; font-weight: 800; text-transform: uppercase; }
    .lock-badge p { color: rgba(255,255,255,0.9); margin: 0; font-size: 14px; text-align: center; }

    /* MODAL */
    .modal-overlay {
      position: fixed; inset: 0; z-index: 999;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
      display: none; align-items: center; justify-content: center;
      animation: fadeIn 0.2s ease-out;
    }
    .modal-box {
      background: #1c1c1e;
      width: 85%; max-width: 320px;
      border-radius: 14px; text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.8);
      transform: scale(0.95);
      animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
      overflow: hidden;
    }
    .modal-header { padding: 24px 16px 20px; }
    .modal-icon { font-size: 32px; margin-bottom: 12px; display: block; }
    .modal-title { color: #fff; font-size: 20px; font-weight: 700; margin-bottom: 8px; }
    .modal-text { color: #aeaeb2; font-size: 15px; line-height: 1.4; }
    .modal-actions { display: flex; border-top: 1px solid #38383a; }
    .modal-btn {
      flex: 1; padding: 18px;
      font-size: 17px; font-weight: 500;
      background: transparent; border: none;
      cursor: pointer; border-right: 1px solid #38383a;
    }
    .modal-btn:last-child { border-right: none; font-weight: 700; }
    .modal-btn:active { background: #2c2c2e; }
    .btn-stay { color: #0a84ff; }
    .btn-leave { color: #8e8e93; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
    @keyframes shake {
      10%, 90% { transform: translate3d(-2px, 0, 0); }
      20%, 80% { transform: translate3d(4px, 0, 0); }
      30%, 50%, 70% { transform: translate3d(-6px, 0, 0); }
      40%, 60% { transform: translate3d(6px, 0, 0); }
    }

    /* UI */
    .reels-ui {
      position: absolute; inset: 0; z-index: 40;
      display: flex; flex-direction: column; justify-content: space-between;
      pointer-events: none;
      background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0) 20%, rgba(0,0,0,0) 80%, rgba(0,0,0,0.7) 100%);
    }
    .top-bar { padding: 50px 16px 20px; display: flex; justify-content: space-between; pointer-events: auto; }
    .back-area { padding: 15px; margin: -15px; cursor: pointer; display: flex; align-items: center; justify-content: center; pointer-events: auto; }

    .right-actions { position: absolute; right: 8px; bottom: 100px; display: flex; flex-direction: column; align-items: center; gap: 16px; pointer-events: auto; }
    .icon-circle { width: 44px; height: 44px; background: rgba(30, 30, 30, 0.65); border-radius: 50%; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
    .action-text { font-size: 12px; font-weight: 600; color: #fff; margin-top: 4px; }

    .bottom-info { padding: 16px; color: #fff; margin-right: 60px; pointer-events: auto; }
    .avatar { width: 32px; height: 32px; border-radius: 50%; background: #ff0050; border: 1px solid #fff; }
    .username { font-weight: 700; font-size: 15px; margin-bottom: 4px; }
    .desc { font-size: 14px; opacity: 0.95; line-height: 1.3; }

    /* swipe animations */
    .slide-out-up { animation: slideOutUp 0.45s cubic-bezier(0.25, 1, 0.5, 1) forwards; }
    .slide-in-up { animation: slideInUp 0.45s cubic-bezier(0.25, 1, 0.5, 1) forwards; visibility: visible !important; z-index: 2 !important; opacity: 1 !important; }

    @keyframes slideOutUp { 0% { transform: translateY(0); } 100% { transform: translateY(-100%); } }
    @keyframes slideInUp { 0% { transform: translateY(100%); } 100% { transform: translateY(0); } }

    .swipe-hint { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 50; pointer-events: none; font-size: 50px; animation: hintMove 1.8s infinite; }
    @keyframes hintMove { 0% { transform: translate(-50%, 40px); opacity: 0; } 40% { opacity: 1; } 100% { transform: translate(-50%, -60px); opacity: 0; } }
  </style>
</head>

<body>
  <div class="reels-wrapper" id="click-trap">
    <video id="v1" class="video-layer active" playsinline webkit-playsinline muted loop preload="auto"></video>
    <video id="v2" class="video-layer" playsinline webkit-playsinline muted loop preload="auto"></video>

    <div id="blur-layer" class="blur-overlay">
      <div class="lock-badge" id="lock-badge">
        <div class="lock-icon-wrap">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2.5">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
        </div>
        <h2 id="t-title">Sensitive Content</h2>
        <p id="t-desc">Tap to unblur and continue</p>
      </div>
    </div>

    <div id="exit-modal" class="modal-overlay">
      <div class="modal-box" role="dialog" aria-modal="true">
        <div class="modal-header">
          <span class="modal-icon">‚ö†Ô∏è</span>
          <div class="modal-title" id="m-title">Wait!</div>
          <div class="modal-text" id="m-text">You are closing a private connection. Access will be lost.</div>
        </div>
        <div class="modal-actions">
          <button class="modal-btn btn-leave" id="btn-leave" type="button">Leave</button>
          <button class="modal-btn btn-stay" id="btn-stay" type="button">Stay</button>
        </div>
      </div>
    </div>

    <div id="swipe-hint" class="swipe-hint">üëÜ</div>

    <div class="reels-ui">
      <div class="top-bar">
        <div class="back-area" id="back-trigger">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </div>
        <div style="background:rgba(50,50,50,0.6); padding:6px 12px; border-radius:20px; color:#fff; font-size:13px;">Filters</div>
      </div>

      <div class="right-actions">
        <div class="action-btn">
          <div class="icon-circle">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
          </div>
          <span class="action-text" id="ui-likes">93</span>
        </div>

        <div class="action-btn">
          <div class="icon-circle">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
              <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"></path>
            </svg>
          </div>
          <span class="action-text">Share</span>
        </div>

        <div class="action-btn">
          <div class="icon-circle">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
              <path d="M14.5 4l-9.5 9.5a2.5 2.5 0 0 0 3.5 3.5l9.5-9.5"/>
              <path d="M18 7L21 4" stroke-width="2.5"/>
              <path d="M14 10L12 7" stroke-width="2"/>
              <path d="M20 10L22 13" stroke-width="2"/>
              <path d="M19.5 2.5l1 1-1 1-1-1 1-1z" fill="white" stroke="none"/>
            </svg>
          </div>
        </div>
      </div>

      <div class="bottom-info">
        <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
          <div class="avatar" id="ui-avatar"></div>
          <div class="username" id="ui-username">@Sweet_Alice</div>
        </div>
        <div class="desc" id="ui-desc">Do you like my view? üòà <br>Check link in bio... üëá</div>
      </div>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // ===== 1) DATA + i18n =====
  const reelsData = [
    {},
    { user: "@Sweet_Alice", likes: "93", desc: "Do you like my view? üòà <br>Check link in bio... üëá", color: "#ff0050" },
    { user: "@Naughty_Kate", likes: "12.4k", desc: "Wait for the end... üí¶ <br>Link in bio!", color: "#0095f6" }
  ];

  const translations = {
    'en': { title: "Sensitive Content", desc: "Tap to unblur and continue", mTitle: "Wait!", mText: "You are closing a private connection. Access will be lost.", stay: "Stay", leave: "Leave" },
    'ru': { title: "–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç", desc: "–ù–∞–∂–º–∏, —á—Ç–æ–±—ã —Å–º–æ—Ç—Ä–µ—Ç—å", mTitle: "–ü–æ–¥–æ–∂–¥–∏!", mText: "–í—ã –∑–∞–∫—Ä—ã–≤–∞–µ—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. –î–æ—Å—Ç—É–ø –±—É–¥–µ—Ç —É—Ç–µ—Ä—è–Ω.", stay: "–û—Å—Ç–∞—Ç—å—Å—è", leave: "–£–π—Ç–∏" },
    'es': { title: "Contenido sensible", desc: "Toca para desbloquear", mTitle: "¬°Espera!", mText: "Est√°s cerrando una conexi√≥n privada. Se perder√° el acceso.", stay: "Quedarse", leave: "Salir" },
    'de': { title: "Sensibler Inhalt", desc: "Zum Entsperren tippen", mTitle: "Warte!", mText: "Sie schlie√üen eine private Verbindung. Der Zugriff geht verloren.", stay: "Bleiben", leave: "Verlassen" },
    'fr': { title: "Contenu sensible", desc: "Appuyez pour d√©bloquer", mTitle: "Attendez !", mText: "Vous fermez une connexion priv√©e. L'acc√®s sera perdu.", stay: "Rester", leave: "Quitter" },
    'pt': { title: "Conte√∫do sens√≠vel", desc: "Toque para desbloquear", mTitle: "Espere!", mText: "Voc√™ est√° fechando uma conex√£o privada. O acesso ser√° perdido.", stay: "Ficar", leave: "Sair" },
    'ar': { title: "ŸÖÿ≠ÿ™ŸàŸâ ÿ≠ÿ≥ÿßÿ≥", desc: "ÿßÿ∂ÿ∫ÿ∑ ŸÑÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÇŸÅŸÑ", mTitle: "ÿßŸÜÿ™ÿ∏ÿ±!", mText: "ÿ£ŸÜÿ™ ÿ™ÿ∫ŸÑŸÇ ÿßÿ™ÿµÿßŸÑÿßŸã ÿÆÿßÿµÿßŸã. ÿ≥Ÿäÿ™ŸÖ ŸÅŸÇÿØÿßŸÜ ÿßŸÑŸàÿµŸàŸÑ.", stay: "ÿßŸÑÿ®ŸÇÿßÿ°", leave: "ÿßŸÑŸÖÿ∫ÿßÿØÿ±ÿ©" }
  };

  const userLang = (navigator.language || 'en').slice(0,2).toLowerCase();
  const t = translations[userLang] || translations.en;
  document.getElementById('t-title').innerText = t.title;
  document.getElementById('t-desc').innerText = t.desc;
  document.getElementById('m-title').innerText = t.mTitle;
  document.getElementById('m-text').innerText = t.mText;
  document.getElementById('btn-stay').innerText = t.stay;
  document.getElementById('btn-leave').innerText = t.leave;
  if (userLang === 'ar') {
    document.getElementById('lock-badge').style.direction = 'rtl';
    document.getElementById('exit-modal').style.direction = 'rtl';
  }

  // ===== 2) Elements =====
  const v1 = document.getElementById('v1');
  const v2 = document.getElementById('v2');
  const swipeHint = document.getElementById("swipe-hint");
  const blurLayer = document.getElementById("blur-layer");
  const lockBadge = document.getElementById("lock-badge");
  const wrapper = document.querySelector('.reels-wrapper');

  const backTrigger = document.getElementById("back-trigger");
  const exitModal = document.getElementById("exit-modal");
  const btnStay = document.getElementById("btn-stay");
  const btnLeave = document.getElementById("btn-leave");

  const uiUser = document.getElementById('ui-username');
  const uiLikes = document.getElementById('ui-likes');
  const uiDesc = document.getElementById('ui-desc');
  const uiAvatar = document.getElementById('ui-avatar');

  // ===== 3) Video src =====
  const urlParams = new URLSearchParams(window.location.search);
  const offerID = urlParams.get('v') || '1';
  const getPath = (index) => `./assets/videos/lend${offerID}/reels-${index}.mp4`;

  v1.src = getPath(1);
  v2.src = getPath(2);
  v2.load();

  v1.play().catch(()=>{});

  // ===== 4) State =====
  let stage = 1;           // 1: first video, 2: second video
  let unlocked = false;    // blur unlocked
  let isAnimating = false;
  let touchStartY = 0;

  // ===== 5) Helpers =====
  function triggerShake() {
    lockBadge.classList.remove('shake');
    void lockBadge.offsetWidth;
    lockBadge.classList.add('shake');
  }

  // –î–µ–ª–∞–µ–º URL –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–æ–Ω—ã (–¥–ª—è Stay/Leave), –Ω–µ —Ç—Ä–æ–≥–∞—è mainExit (–µ–≥–æ –¥–µ–ª–∞–µ—Ç —Ç–≤–æ–π common)
  function buildExitUrl(zoneId) {
    // –ë–µ—Ä–µ–º —Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –¥–æ–±–∞–≤–ª—è–µ–º z –∏ domain.
    // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ: —Ç–≤–æ–π —Ç—Ä–µ–∫–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç.
    const qs = new URLSearchParams(window.location.search);
    qs.set("z", String(zoneId));
    qs.set("domain", (APP_CONFIG && APP_CONFIG.domain) ? APP_CONFIG.domain : "");
    // –µ—Å–ª–∏ —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å var/var_1/var_2 –∏ —Ç.–¥. ‚Äî –æ–Ω–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è
    const base = (APP_CONFIG && APP_CONFIG.domain) ? APP_CONFIG.domain.replace(/\/+$/,'') : "";
    return `${base}/afu.php?${qs.toString()}`;
  }

  function openNewTab(url) {
    const w = window.open(url, "_blank");
    if (w) w.opener = null;
  }

  function doSwap() {
    if (isAnimating) return;
    isAnimating = true;

    swipeHint.style.display = 'none';

    // UI update to video2
    const newData = reelsData[2];
    uiUser.innerText = newData.user;
    uiLikes.innerText = newData.likes;
    uiDesc.innerHTML = newData.desc;
    uiAvatar.style.backgroundColor = newData.color;

    // –∞–Ω–∏–º–∞—Ü–∏—è (–∫–∞–∫ —É —Ç–µ–±—è)
    v1.classList.add('slide-out-up');
    v2.classList.add('slide-in-up');
    v2.play().catch(()=>{});

    setTimeout(() => {
      v1.pause();
      v1.classList.remove('active', 'slide-out-up');

      v2.classList.add('active');
      v2.classList.remove('slide-in-up');

      // –≤–∫–ª—é—á–∞–µ–º blur (lock)
      unlocked = false;
      blurLayer.style.display = 'flex';

      stage = 2;
      isAnimating = false;
    }, 450);
  }

  function unlockBlur() {
    unlocked = true;
    blurLayer.style.display = 'none';
  }

  // ===== 6) Swipe =====
  wrapper.addEventListener('touchstart', (e) => {
    touchStartY = e.changedTouches[0].screenY;

    // –ø–æ–¥–æ–≥—Ä–µ–≤ –≤—Ç–æ—Ä–æ–≥–æ –≤–∏–¥–µ–æ (—á–∞—Å—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç "—á–µ—Ä–Ω—ã–π –∫–∞–¥—Ä" –≤ webview)
    if (stage === 1 && v2.readyState < 3) {
      v2.play().then(() => v2.pause()).catch(()=>{});
    }
  }, { passive: true });

  wrapper.addEventListener('touchend', (e) => {
    const touchEndY = e.changedTouches[0].screenY;
    const isSwipeUp = (touchStartY - touchEndY) > 50;
    if (!isSwipeUp) return;

    if (stage === 1) {
      // –í–∞–∂–Ω–æ: reverse/backfix —É —Ç–≤–æ–µ–≥–æ common –≤–∏—Å–∏—Ç –Ω–∞ capture-–∫–ª–∏–∫–µ,
      // —Å–≤–∞–π–ø –µ–≥–æ –Ω–µ –¥–∞–µ—Ç, –ø–æ—ç—Ç–æ–º—É –Ω–∞–±–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –≤—Ä—É—á–Ω—É—é:
      // —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π click, –Ω–æ –ù–ï –¥–∞–µ–º –µ–º—É —É–π—Ç–∏ –Ω–∞ mainExit.
      const fake = new MouseEvent('click', { bubbles: true, cancelable: true });
      wrapper.dispatchEvent(fake);

      doSwap();
      return;
    }

    // stage2 swipe
    triggerShake();
  }, { passive: true });

  // ===== 7) Click routing =====
  // –ö—Ä–∏—Ç–∏—á–Ω–æ: –Ω–∞ stage2 –ø–æ—Å–ª–µ unlock –º—ã –ù–ï –±–ª–æ–∫–∏—Ä—É–µ–º –∫–ª–∏–∫ ‚Äî –ø—É—Å—Ç—å —É–ª–µ—Ç–∞–µ—Ç –≤ document,
  // –∏ —Ç–≤–æ–π common-—Å–∫—Ä–∏–ø—Ç —Å–∞–º —Å–¥–µ–ª–∞–µ—Ç mainExit.
  wrapper.addEventListener('click', (e) => {
    // –∏–≥–Ω–æ—Ä –∫–ª–∏–∫–æ–≤ –ø–æ –º–æ–¥–∞–ª–∫–µ
    if (e.target.closest('#exit-modal')) return;

    // stage1: –ª—é–±–æ–π –∫–ª–∏–∫ = swap, –Ω–æ mainExit –ù–ï –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–æ—Ç–∞—Ç—å
    if (stage === 1) {
      // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º capture-—Å–ª—É—à–∞—Ç–µ–ª–∏ (–æ–Ω–∏ —É–∂–µ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∏), –Ω–æ –≥–∞—Å–∏–º bubble –¥–æ document
      e.preventDefault();
      e.stopPropagation();
      e.stopImmediatePropagation();

      doSwap();
      return;
    }

    // stage2: –µ—Å–ª–∏ blur –Ω–µ —Å–Ω—è—Ç ‚Äî –∫–ª–∏–∫ —Ç–æ–ª—å–∫–æ unlock (–∏ –≥–∞—Å–∏–º, —á—Ç–æ–±—ã mainExit –Ω–µ —É–ª–µ—Ç–µ–ª)
    if (stage === 2 && !unlocked) {
      if (e.target.closest('#blur-layer') || e.target.closest('#lock-badge')) {
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        unlockBlur();
      } else {
        triggerShake();
      }
      return;
    }

    // stage2 unlocked: –ù–ò–ß–ï–ì–û –ù–ï –î–ï–õ–ê–ï–ú –∏ –ù–ï –ë–õ–û–ö–ò–†–£–ï–ú
    // => –∫–ª–∏–∫ —É–π–¥–µ—Ç –Ω–∞–≤–µ—Ä—Ö –∏ —Ç–≤–æ–π common –≤—ã–∑–æ–≤–µ—Ç mainExit –∫–∞–∫ —Ä–∞–Ω—å—à–µ
  }, false);

  // ===== 8) Back arrow / modal =====
  backTrigger.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();

    if (stage === 1) {
      // –Ω–∞ –ø–µ—Ä–≤–æ–º —ç–∫—Ä–∞–Ω–µ —Å—Ç—Ä–µ–ª–∫–∞ –≤–µ–¥–µ—Ç –∫–∞–∫ "–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ" -> swap
      doSwap();
      return;
    }
    exitModal.style.display = "flex";
  });

  // Stay -> tabUnderClick (new tab), user stays
  btnStay.addEventListener('click', (e) => {
    e.preventDefault(); e.stopPropagation();
    exitModal.style.display = "none";

    const zid = APP_CONFIG && APP_CONFIG.tabUnderClick_newTab_zoneId;
    if (zid) openNewTab(buildExitUrl(zid));
  });

  // Leave -> ageExit (current tab)
  btnLeave.addEventListener('click', (e) => {
    e.preventDefault(); e.stopPropagation();

    const zid = APP_CONFIG && APP_CONFIG.ageExit_currentTab_zoneId;
    if (zid) window.location.href = buildExitUrl(zid);
  });

  // click outside modal closes it
  exitModal.addEventListener('click', (e) => {
    if (e.target === exitModal) exitModal.style.display = "none";
  });
});
</script>

  <!-- —Ç–≤–æ–π COMMON (Propush / exits) ‚Äî –æ—Å—Ç–∞–≤–ª—è–π –∫–∞–∫ —É —Ç–µ–±—è -->
  <!-- –í–°–¢–ê–í–¨ –°–Æ–î–ê –¢–í–û–ô –ú–ò–ù–§–ò–¶–ò–†–û–í–ê–ù–ù–´–ô –°–ö–†–ò–ü–¢ (–Ω–µ –º–µ–Ω—è–ª) -->
</body>
</html>
